version: 2
jobs:
  build:
    docker:
    - image: jjcg/sq-base:00
    steps:
    - checkout
    - run:
        name: test
        command: |
          PATH=$PATH:/opt/jdk-minimal/bin/
          mv /opt/jdk-minimal  /opt/java
          ls -l /opt/java
          PATH=$PATH:/opt/java/bin/
          java -version
    - run:
        name: sys update
        command: apt-get update
    - run:
        name: sys update
        command: apt-get upgrade -y
    - run:
        name: install packages
        command:  apt-get install -y unzip wget procps software-properties-common unzip wget apt-utils vim nginx supervisor libpq-dev libjpeg-dev screen tmux man build-essential
    - run:
        name: Install Sonarqube
        command: |
          wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.8.zip
          ls -l /opt/
          mkdir -p /opt/sonarqube-7.8
          unzip ./sonarqube-7.8.zip
          cp -a ./sonarqube-7.8/.  /opt/sonarqube-7.8/
          ls /opt
    - run:
        name: Run Sonarqube
        command: |
          pwd
          ls /opt/
          ls /opt/sonarqube-7.8/bin/linux-x86-64/
          ls /opt/sonarqube-7.8/conf/
          #sed 's/wrapper.java.command/opt/jdk-minimal/bin/' ./sonarqube-7.8/conf/wrapper.conf
          ./opt/sonarqube-7.8/bin/linux-x86-64/sonar.sh console
    - run:
        name: shell
        command: |
          /bin/bash

#    - run:
#        name: Install Sonarqube scanner
#        command: |
#          wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.0.0.1744-linux.zip
#            unzip sonar-scanner-cli-4.0.0.1744-linux.zip
#    - run:
#        name: Run Sonarqube scanner
#        command: |
#          eval ./sonar-scanner-4.0.0.1744-linux/bin/sonar-scanner -Dsonar.projectKey=${CIRCLE_PROJECT_REPONAME} \
#          -Dsonar.projectVersion=${CIRCLE_BRANCH} \
#          -Dsonar.host.url=http://54.160.99.9:9000 \
#          -Dsonar.login=81948a1dfc757648fa3b92b8a513ec0a6e03e947

